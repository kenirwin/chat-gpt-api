<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Poem</title>
    <!-- add jquery and bootstrap 5-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js
    "></script>
    <script>
        $(document).ready(function() {
            $('#submit').click(function() {
                var location = $('#location').val();
                var poemType = $('#poemType').val();
                var poemTypeName = $('#poemType option:selected').text();
                var locationName = $('#location option:selected').text();
                $('#weather').addClass('placeholder');
                $('#poem').html('Loading...').addClass('placeholder');
                $.ajax({
                    url: './weather',
                    type: 'GET',
                    data: {
                        location: location,
                        poemType: poemType
                    },
                    success: function(data) {
                        let weather = data.weather.replaceAll('. ','<br>');
                        let weatherHeader = `<h2>Weather for ${locationName}</h2>`;
                        $('#weather').html(weatherHeader + weather).removeClass('placeholder');
                        let poem = data.poem.replaceAll('\n', '<br>');
                        let poemHeader = `<h2>${poemTypeName} for ${locationName}</h2>`;
                        $('#poem').html(poemHeader + poem).removeClass('placeholder');
                    }
                })
            });
        });
    </script>
    <!-- add css -->
    <!-- <link rel="stylesheet" href="css/style.css"> -->
    <!-- add js -->
    <!-- <script src="js/script.js"></script> -->
</head>
<body>
    <div class="container">
        <h1>Weather Poem</h1>
        <form class="form mb-5">
            <div class="row">

            <div class="col-md-3">
                <label for="location">Location</label><br>
                <select class="form-select" name="location" id="location">
                    <% stations.forEach((stn) => {
                        %>
                        <option value="<%= stn.id %>"><%= stn.name.en %></option>
                        <%
                    });
                    %>
                </select>
            </div>

            <div class="col-md-3">
                <label for="poemType">Poetic Form</label><br>
                <select class="form-select" name="poemType" id="poemType">
                    <option value="haiku">Haiku</option>
                    <option value="limerick">Limerick</option>
                    <option value="sestina">Sestina</option>
                    <option value="sonnet">Sonnet</option>
                    <option value="villanelle">Villanelle</option>
                </select>
            </div>

            <div class="col-md-3">
                <br>
                <input type="button" id="submit" value="Generate Poem" class="btn btn-primary align-bottom">
            </div>
        </div>
        </form>
        <div class="row">
            <div class="col-md-6 bg-info-subtle" id="poem"></div>
            <div class="col-md-4 offset-md-1 bg-secondary text-white" id="weather"></div>
        </div>
    </div>
</body>
</html>